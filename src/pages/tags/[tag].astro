---
import type { MarkdownInstance } from "astro";
import BaseLayout from "@layouts/base-layout.astro";
import PostListing from "@components/post-listing.astro";

export interface Props {
    posts: MarkdownInstance<Record<string, any>>[];
}

export async function getStaticPaths() {
    const posts = await Astro.glob("../posts/*.md");
    const tags = [
        ...new Set(posts.map((post) => post.frontmatter.tags).flat()),
    ];

    return tags.map((tag) => {
        const filteredPosts = posts
            .filter((post) => post.frontmatter.tags.includes(tag))
            .sort(
                (a, b) =>
                    new Date(b.frontmatter.date).getTime() -
                    new Date(a.frontmatter.date).getTime()
            );

        return {
            params: { tag },
            props: { posts: filteredPosts },
        };
    });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout title={`Tag '${tag}'`}>
    <h1>Posts tagged with <span>{tag}</span></h1>
    {posts.map((post) => <PostListing post={post} />)}
</BaseLayout>
<style>
    span {
        color: var(--color-accent);
    }
</style>
